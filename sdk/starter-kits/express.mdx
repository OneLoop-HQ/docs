---
title: "Express"
---

<Icon icon="github" iconType="solid" color="#000000" /> [Github](https://github.com/oneloop-starter-kits/express)

The express starter kit leverages the Oneloop nodejs SDK, but provides a helpful middleware that can be used for verifying API keys.

You can fork the starter kit repo, or copy the middleware from it.

## Installation

```bash
npm install @oneloop-hq/oneloop-ts
```

<Info>
  To learn more about the this SDK, you can visit the [NodeJS SDK
  documentation](/sdk/nodejs).
</Info>

## Usage

### Middleware

Let's first add the middleware that will be used to verify the API key. This will save you from having to write the same code in every route.

```typescript middleware.ts
import { OneloopApiClient } from "@oneloop-hq/oneloop-ts";

const oneloopClient = new OneloopApiClient({
  token: process.env.ONELOOP_KEY ?? "",
});

export const oneloopMiddleware = (
  scopes: {
    id: string;
    read?: boolean;
    create?: boolean;
    update?: boolean;
    del?: boolean;
  }[]
) => {
  return async (req: Request, res: Response, next: () => any) => {
    const key = req.headers.authorization?.replace("Bearer ", "") ? "":
    if (!key) {
        return res.status(401).send("Unauthorized")
    }

    const verifyApiKeyResponse = await oneloopClient.verifyApiKey({
      key,
      requestedScopes: scopes.map((scope) => {
        return {
          id: scope.id,
          representation: scope.id,
          read: scope.read ?? false,
          create: scope.create ?? false,
          update: scope.update ?? false,
          del: scope.del ?? false,
        };
      }),
    });

    if (verifyApiKeyResponse.status === "VALID") {
      next();
    } else {
      res.status(401).send("Unauthorized");
    }
  };
};

```

### Authenticate the API key

Now, let's use the middleware in a FastApi route and authenticate the API key.

```typescript
// Install the middleware on the express app
app.post("/profile", oneloopMiddleware(), handler);
```

### Checking for permissions

You can also check for permissions in your routes. Let's say you have a route that requires a specific read access for profile data.
You want to check if the API key has the required scope before returning the data. You can pass that scope to the middleware.

Let's modify the above route to check for `profile` read access.

```typescript
app.post(
  "/profile",
  oneloopMiddleware([{ id: "profile", read: true }]),
  handler
);
```
